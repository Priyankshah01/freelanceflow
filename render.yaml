# render.yaml - Render Blueprint for full-stack deployment
# Place this file in the ROOT of your repository (same level as /client and /server)

services:
  # ----------------- Backend Service (Express + MongoDB) -----------------
  - type: web
    name: freelanceflow-backend
    runtime: node
    rootDir: server
    buildCommand: "npm ci"
    startCommand: "npm start"
    healthCheckPath: "/api/__health"
    plan: free
    envVars:
      # Secrets youâ€™ll set manually in the Render Dashboard
      - key: MONGODB_URI
        sync: false
      - key: JWT_SECRET
        sync: false
      # Automatically inject frontend URL once static site is deployed
      - key: FRONTEND_URL
        fromService:
          name: freelanceflow-frontend
          type: web
          envVarKey: RENDER_EXTERNAL_URL

  # ----------------- Frontend Service (Vite/React) -----------------
  - type: web
    name: freelanceflow-frontend
    runtime: static
    rootDir: client
    buildCommand: "npm ci && npm run build"
    staticPublishPath: "dist"
    plan: free
    envVars:
      # Automatically inject backend API URL into Vite build
      - key: VITE_API_URL
        fromService:
          name: freelanceflow-backend
          type: web
          envVarKey: RENDER_EXTERNAL_URL
